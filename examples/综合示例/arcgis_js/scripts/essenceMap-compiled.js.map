{"version":3,"sources":["essenceMap.js"],"names":[],"mappings":"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","file":"essenceMap-compiled.js","sourcesContent":["/**\r\n * Created by laixiangran on 2016/5/20.\r\n * 主页: http://www.laixiangran.cn\r\n * 常用GIS方法\r\n */\r\n(function(window) {\r\n\r\n    var eMap = window.eMap = {};\r\n\r\n    require([\r\n        \"esri/map\",\r\n        \"esri/urlUtils\",\r\n        \"esri/config\",\r\n        \"esri/SpatialReference\",\r\n        \"esri/layers/WebTiledLayer\",\r\n        \"esri/layers/TileInfo\",\r\n        \"esri/geometry/Point\",\r\n        \"esri/tasks/FeatureSet\",\r\n        \"esri/tasks/ProjectParameters\",\r\n        \"esri/dijit/OverviewMap\",\r\n        \"esri/dijit/Scalebar\",\r\n        \"esri/dijit/BasemapGallery\",\r\n        \"esri/dijit/BasemapLayer\",\r\n        \"esri/dijit/Basemap\",\r\n        \"dojo/domReady!\"\r\n    ], function(\r\n        Map,\r\n        urlUtils,\r\n        esriConfig,\r\n        SpatialReference,\r\n        WebTiledLayer,\r\n        TileInfo,\r\n        Point,\r\n        FeatureSet,\r\n        ProjectParameters,\r\n        OverviewMap,\r\n        Scalebar,\r\n        BasemapGallery,\r\n        BasemapLayer,\r\n        Basemap\r\n    ) {\r\n\r\n        var mapInfo = {\r\n            tdt: {\r\n                // 天地图瓦片结构\r\n                tileInfo: new TileInfo({\r\n                    rows: 256,\r\n                    cols: 256,\r\n                    compressionQuality: 0,\r\n                    origin: {\r\n                        x: -180,\r\n                        y: 90\r\n                    },\r\n                    spatialReference: {\r\n                        wkid: 4326\r\n                    },\r\n                    lods: [\r\n                        {\"level\" : 2, \"resolution\" : 0.3515625, \"scale\" : 147748796.52937502},\r\n                        {\"level\" : 3, \"resolution\" : 0.17578125, \"scale\" : 73874398.264687508},\r\n                        {\"level\" : 4, \"resolution\" : 0.087890625, \"scale\" : 36937199.132343754},\r\n                        {\"level\" : 5, \"resolution\" : 0.0439453125, \"scale\" : 18468599.566171877},\r\n                        {\"level\" : 6, \"resolution\" : 0.02197265625, \"scale\" : 9234299.7830859385},\r\n                        {\"level\" : 7, \"resolution\" : 0.010986328125, \"scale\" : 4617149.8915429693},\r\n                        {\"level\" : 8, \"resolution\" : 0.0054931640625, \"scale\" : 2308574.9457714846},\r\n                        {\"level\" : 9, \"resolution\" : 0.00274658203125, \"scale\" : 1154287.4728857423},\r\n                        {\"level\" : 10, \"resolution\" : 0.001373291015625, \"scale\" : 577143.73644287116},\r\n                        {\"level\" : 11, \"resolution\" : 0.0006866455078125, \"scale\" : 288571.86822143558},\r\n                        {\"level\" : 12, \"resolution\" : 0.00034332275390625, \"scale\" : 144285.93411071779},\r\n                        {\"level\" : 13, \"resolution\" : 0.000171661376953125, \"scale\" : 72142.967055358895},\r\n                        {\"level\" : 14, \"resolution\" : 8.58306884765625e-005, \"scale\" : 36071.483527679447},\r\n                        {\"level\" : 15, \"resolution\" : 4.291534423828125e-005, \"scale\" : 18035.741763839724},\r\n                        {\"level\" : 16, \"resolution\" : 2.1457672119140625e-005, \"scale\" : 9017.8708819198619},\r\n                        {\"level\" : 17, \"resolution\" : 1.0728836059570313e-005, \"scale\" : 4508.9354409599309},\r\n                        {\"level\" : 18, \"resolution\" : 5.3644180297851563e-006, \"scale\" : 2254.4677204799655}\r\n                    ]\r\n                }),\r\n\r\n                // 天地图子域名\r\n                subDomains: [\"t0\", \"t1\", \"t2\", \"t3\", \"t4\", \"t5\", \"t6\", \"t7\"],\r\n\r\n                // 天地图服务路径模板\r\n                templateUrl: \"http://${subDomain}.tianditu.com/DataServer?T=tdtType_c&X=${col}&Y=${row}&L=${level}\"\r\n            }\r\n        };\r\n\r\n        /**\r\n         * @description 初始化地图\r\n         * @method initMap\r\n         * @for essenceMap.js\r\n         * @param {Node,String} mapDiv 地图所在的容器（元素节点或者元素id）\r\n         * @param {Object} params 初始化参数，具体见esri.Map中的参数\r\n         * @param {Function} callback 地图加载完成之后的回调函数\r\n         * @return {map}\r\n         */\r\n        eMap.initMap = function(mapDiv, params, callback) {\r\n            eMap.map = new Map(mapDiv, params);\r\n            eMap.map.on(\"load\", callback(eMap.map));\r\n        };\r\n\r\n        /**\r\n         * @description 初始化鹰眼部件\r\n         * @method initOverviewMap\r\n         * @for essenceMap.js\r\n         * @param {Object} params 初始化参数，具体见esri.dijit.OverviewMap中的参数\r\n         * @param {Node,String} srcNode 放置的容器\r\n         * @return {OverviewMap}\r\n         */\r\n        eMap.initOverviewMap = function(params, srcNode) {\r\n            params.visible = params.visible === undefined ? true : params.visible;\r\n            params.attachTo = params.attachTo || \"bottom-right\";\r\n            var overviewMapDijit = new OverviewMap(params, srcNode);\r\n            overviewMapDijit.startup();\r\n            return overviewMapDijit;\r\n        };\r\n\r\n        /**\r\n         * @description 初始化比例尺部件\r\n         * @method initScalebar\r\n         * @for essenceMap.js\r\n         * @param {Object} params 初始化参数，具体见esri.dijit.Scalebar中的参数\r\n         * @param {Node,String} srcNode 放置的容器\r\n         * @return {Scalebar}\r\n         */\r\n        eMap.initScalebar = function(params, srcNode) {\r\n            params.scalebarUnit = params.scalebarUnit || \"dual\";\r\n            return new Scalebar(params, srcNode);\r\n        };\r\n\r\n        /**\r\n         * @description 初始化底图切换部件\r\n         * @method initBasemapGallery\r\n         * @for essenceMap.js\r\n         * @param {Object} params 初始化参数，\r\n         * mapType: \"tdt\", // 地图类型，暂支持\"tdt\"（天地图），\"esri\"（arcgis）\r\n         * layers: [[\"vec\", \"cva\"], [\"img\", \"cia\"]], // mapType = \"tdt\"时为服务的别名，mapType = \"esri\"时为arcgis地图服务url\r\n         * titles: [\"地图\", \"影像\"], // 名称，与layers对应\r\n         * thumbnailUrls: [\"images/tianditu_map_zh.jpg\", \"images/tianditu_imagery_zh.jpg\"] // 拇指图，与layers对应\r\n         * @param {Node,String} srcNode 放置的容器\r\n         * @return {BasemapGallery}\r\n         */\r\n        eMap.initBasemapGallery = function(params, srcNode) {\r\n            var basemaps = [];\r\n            if (params.mapType === \"tdt\") {\r\n                params.layers.forEach(function(bs, index) {\r\n                    var basemapLayers = [];\r\n                    bs.forEach(function(bsl) {\r\n                        var basemapLayer = new BasemapLayer({\r\n                            templateUrl: mapInfo[params.mapType].templateUrl.replace(\"tdtType\", bsl),\r\n                            tileInfo: mapInfo[params.mapType].tileInfo,\r\n                            subDomains: mapInfo[params.mapType].subDomains,\r\n                            type: \"WebTiledLayer\"\r\n                        });\r\n                        basemapLayers.push(basemapLayer);\r\n                    });\r\n                    var basemap = new Basemap({\r\n                        layers: basemapLayers,\r\n                        title: params.titles[index],\r\n                        thumbnailUrl: params.thumbnailUrls[index]\r\n                    });\r\n                    basemaps.push(basemap);\r\n                });\r\n            } else if (params.mapType === \"esri\") {\r\n                params.layers.forEach(function(bs, index) {\r\n                    bs.forEach(function(bsl) {\r\n                        var basemapLayer = new BasemapLayer({\r\n                            url: bsl\r\n                        });\r\n                        basemapLayers.push(basemapLayer);\r\n                    });\r\n                    var basemap = new Basemap({\r\n                        layers: basemapLayers,\r\n                        title: params.titles[index],\r\n                        thumbnailUrl: params.thumbnailUrls[index]\r\n                    });\r\n                    basemaps.push(basemap);\r\n                });\r\n            }\r\n\r\n            var basemapGallery = new BasemapGallery({\r\n                showArcGISBasemaps: false,\r\n                map: eMap.map,\r\n                basemaps: basemaps\r\n            }, srcNode);\r\n            basemapGallery.startup();\r\n\r\n            basemapGallery.on(\"error\", function(msg) {\r\n                throw \"basemap gallery error:  \" + msg;\r\n            });\r\n\r\n            return basemapGallery;\r\n        };\r\n\r\n        /**\r\n         * @description 设置代理\r\n         * @method setPoxy\r\n         * @for essenceMap.js\r\n         * @param {String} proxyUrl 代理文件路径\r\n         * @param {Boolean} isAlwaysUse 是否始终使用代理\r\n         * @return {map}\r\n         */\r\n        eMap.setPoxy = function(proxyUrl, isAlwaysUse) {\r\n            esriConfig.defaults.io.proxyUrl = proxyUrl;\r\n            esriConfig.defaults.io.alwaysUseProxy = isAlwaysUse;\r\n            urlUtils.addProxyRule({\r\n                urlPrefix: \"route.arcgis.com\",\r\n                proxyUrl: proxyUrl\r\n            });\r\n        };\r\n\r\n        /**\r\n         * @description 注册事件\r\n         * @method addMapEvent\r\n         * @for essenceMap.js\r\n         * @param {Object} obj 事件类型\r\n         * @param {String} evtType 事件类型\r\n         * @param {Function} callback 监听方法\r\n         * */\r\n        eMap.addEvent = function(obj, evtType, callback) {\r\n            obj.on(evtType, callback);\r\n        };\r\n\r\n        /**\r\n         * @description 加载天地图\r\n         * @method addTdtLayer\r\n         * @for essenceMap.js\r\n         * @param {String} tdtType 地图类型，取值包括：vec：矢量地图，img：影像图，ter：地形图，cva：矢量地图中文注记，eva：矢量地图英文注记，cia：影像图中文注记，eia：影像图英文注记，cva：地形图中文注记\r\n         * @param {Number} index 按指定的索引加载地图\r\n         * @return {WebTiledLayer}\r\n         */\r\n        eMap.addTdtLayer = (function() {\r\n            var tdtId = 0;\r\n            return function(tdtType, index) {\r\n                var tdtLayer = new WebTiledLayer(mapInfo[\"tdt\"].templateUrl.replace(\"tdtType\", tdtType), {\r\n                    id: \"baseMap\" + (tdtId++),\r\n                    subDomains: mapInfo[\"tdt\"].subDomains,\r\n                    tileInfo: mapInfo[\"tdt\"].tileInfo\r\n                });\r\n                eMap.map.addLayer(tdtLayer, index);\r\n                return tdtLayer;\r\n            };\r\n        })();\r\n\r\n        /**\r\n         * @description 根据JSON转化成featureset, 坐标系为WGS_1984（4326）\r\n         * @method JSONToFeatureSet\r\n         * @for essenceMap.js\r\n         * @param {Array} dataArr 对象数组\r\n         * @param {Number} wkid 坐标系编码\r\n         * @return {FetureSet} 要素集\r\n         */\r\n        function JSONToFeatureSet(dataArr, wkid){\r\n            var fs = new FeatureSet(),\r\n                inSR = new SpatialReference(wkid);\r\n\r\n            fs.features = [];\r\n            fs.spatialReference = inSR;\r\n            for (var i = 0; i < dataArr.length; i++) {\r\n                try {\r\n                    var obj = dataArr[i];\r\n                    var pt = new Point(latToDec(obj.x), latToDec(obj.y), inSR);\r\n                    var gra = new Graphic(pt,null,obj);\r\n                    fs.features.push(gra);\r\n                } catch(e) {\r\n                    throw e;\r\n                }\r\n            }\r\n            return fs;\r\n        }\r\n\r\n        /**\r\n         * @description 转换要素的坐标系，精度高\r\n         * @method ExactProject\r\n         * @for essenceMap.js\r\n         * @param {FeatureSet} fs 要素集\r\n         * @param {Number} wkid 输出坐标系编码\r\n         * @param {Function} callback 回调函数，函数格式function(FeatureSet)\r\n         * */\r\n        function ExactProject(fs, wkid, callback) {\r\n            var geometries = [],\r\n                attrs = [],\r\n                outSR = new SpatialReference(wkid);\r\n\r\n            for(var i = 0; i < fs.features.length; i++){\r\n                var gra = fs.features[i];\r\n                geometries.push(gra.geometry);\r\n                attrs.push(gra.attributes);\r\n            }\r\n            var ps = new ProjectParameters();\r\n            ps.geometries = geometries;\r\n            ps.outSR = outSR;\r\n            geometryService.project(ps, function(geometries) {\r\n                var fs = new FeatureSet();\r\n                fs.spatialReference = outSR;\r\n                fs.features = [];\r\n                for(var j = 0; j < geometries.length; j++) {\r\n                    var geo = geometries[j];\r\n                    var attr = attrs[j];\r\n                    var pt = new Point(geo.x, geo.y, eMap.map.spatialReference);\r\n                    var gra = new Graphic(pt,null,attr);\r\n                    fs.features.push(gra);\r\n                }\r\n                callback(fs);\r\n            }, function(error){\r\n                throw error;\r\n            });\r\n        }\r\n\r\n        /**\r\n         * @description 将坐标由度分秒表示转为十进制表示\r\n         * @method latToDec\r\n         * @for essenceMap.js\r\n         * @param {String} dfm 度分秒表示-180°0′0″\r\n         * @return {Number} 十进制\r\n         */\r\n        function latToDec(dfm){\r\n            var lod = Number(dfm.split(\"°\")[0]),\r\n                lom = Number(dfm.split(\"°\")[1].split(\"′\")[0]),\r\n                los = Number(dfm.split(\"°\")[1].split(\"′\")[1].split(\"″\")[0]);\r\n            return lod+lom/60+los/3600;\r\n        }\r\n\r\n        /**\r\n         * @description 将坐标由十进制表示转为度分秒表示\r\n         * @method decToLat\r\n         * @for essenceMap.js\r\n         * @param {Number} sjz 十进制表示-180.00\r\n         * @return {String} 度分秒表示-180°0′0″\r\n         */\r\n        function decToLat(sjz){\r\n            var d = String(sjz).split(\".\"),\r\n                f = String(Number(\"0.\"+d[1])*60).split(\".\");\r\n            return d[0]+\"°\"+f[0]+\"′\"+(Number(\"0.\"+f[1])*60).toFixed(2)+\"″\";\r\n        }\r\n    });\r\n})(window);"]}